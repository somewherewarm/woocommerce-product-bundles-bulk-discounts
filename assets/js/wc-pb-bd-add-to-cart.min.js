!function(o){function n(t){this.filter_bundle_totals=function(t,a,i,n){if(void 0===a.bulk_discount_data||!1===a.bulk_discount_data)return t;var e=a.quantities,_=a.bulk_discount_data.discount_array,s=0,u=0;if(0<_.length){for(var l in e)u+=e[l];for(var c=0;c<_.length;c++)void 0!==_[c].quantity_min&&void 0!==_[c].quantity_max&&void 0!==_[c].discount&&u>=_[c].quantity_min&&(u<=_[c].quantity_max||""===_[c].quantity_max)&&(s=_[c].discount);if(0<(i.price_data.bulk_discount_data.discount=s)){var d=o.extend(!0,{},a);o.each(i.bundled_items,function(t,a){d.prices[a.bundled_item_id]=d.prices[a.bundled_item_id]*(1-s/100)}),"yes"===i.price_data.bulk_discount_data.discount_base&&d.base_price&&(d.base_price=Number(d.base_price)*(1-s/100)),d.bulk_discount_data=!1,d=i.calculate_subtotals(!1,d,n),t=(d=i.calculate_totals(d)).totals}}return t},this.filter_bundle_total_price_html=function(t,a){if(void 0===a.price_data.bulk_discount_data)return t;if(a.price_data.bulk_discount_data.discount&&a.price_data.subtotals.price!==a.price_data.totals.price){var i,n=o.extend(!0,{},a.price_data);n.totals.regular_price=n.subtotals.price,t=a.get_price_html(n),n.totals=n.subtotals,n.show_total_string="yes",i=a.get_price_html(n);var e='<span class="discount">'+wc_bundle_params.i18n_bulk_discount+"</span>",_='<span class="discount-amount">'+wc_bundle_params.i18n_bulk_discount_value.replace("%v",wc_pb_number_round(a.price_data.bulk_discount_data.discount,2))+"</span>",s='<span class="price-discount">'+wc_bundle_params.i18n_bulk_discount_format.replace("%s",e).replace("%v",_)+"</span>",u=o(t).wrapInner('<span class="price-total"></span>'),l=o(i).wrapInner('<span class="price-subtotal"></span>');l.find("span.total").text(wc_bundle_params.i18n_bulk_discount_subtotal),l.append(s),l.append(u.html()),t=l.prop("outerHTML")}return t},this.initialize=function(){t.filters.add_filter("bundle_totals",this.filter_bundle_totals,10,this),t.filters.add_filter("bundle_total_price_html",this.filter_bundle_total_price_html,10,this)}}o(".bundle_form .bundle_data").on("woocommerce-product-bundle-initializing",function(t,a){new n(a).initialize()}),o(".composite_component").on("wc-composite-component-loaded",function(t,a){if("bundle"===a.get_selected_product_type()){var i=a.get_bundle_script();new n(i).initialize()}})}(jQuery);