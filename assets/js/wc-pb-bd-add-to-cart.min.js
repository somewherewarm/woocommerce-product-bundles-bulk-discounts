!function(t){var a=function(a){this.filter_bundle_totals=function(a,i,n,e){if(void 0===i.bulk_discount_data||!1===i.bulk_discount_data)return a;var _=i.quantities,s=i.bulk_discount_data.discount_array,u=0,l=0;if(s.length>0){for(var d in _)l+=_[d];for(var c=0;c<s.length;c++)void 0!==s[c].quantity_min&&void 0!==s[c].quantity_max&&void 0!==s[c].discount&&l>=s[c].quantity_min&&(l<=s[c].quantity_max||""===s[c].quantity_max)&&(u=s[c].discount);if(n.price_data.bulk_discount_data.discount=u,u>0){var o=t.extend(!0,{},i);t.each(n.bundled_items,function(t,a){o.prices[a.bundled_item_id]=o.prices[a.bundled_item_id]*(1-u/100)}),"yes"===n.price_data.bulk_discount_data.discount_base&&o.base_price&&(o.base_price=Number(o.base_price)*(1-u/100)),o.bulk_discount_data=!1,o=n.calculate_subtotals(!1,o,e),a=(o=n.calculate_totals(o)).totals}}return a},this.filter_bundle_total_price_html=function(a,i){if(void 0===i.price_data.bulk_discount_data)return a;if(i.price_data.bulk_discount_data.discount&&i.price_data.subtotals.price!==i.price_data.totals.price){var n="",e=t.extend(!0,{},i.price_data);e.totals.regular_price=e.subtotals.price,a=i.get_price_html(e),e.totals=e.subtotals,e.show_total_string="yes",n=i.get_price_html(e);var _='<span class="discount">'+wc_bundle_params.i18n_bulk_discount+"</span>",s='<span class="discount-amount">'+wc_bundle_params.i18n_bulk_discount_value.replace("%v",wc_pb_number_round(i.price_data.bulk_discount_data.discount,2))+"</span>",u='<span class="price-discount">'+wc_bundle_params.i18n_bulk_discount_format.replace("%s",_).replace("%v",s)+"</span>",l=t(a).wrapInner('<span class="price-total"></span>'),d=t(n).wrapInner('<span class="price-subtotal"></span>');d.find("span.total").text(wc_bundle_params.i18n_bulk_discount_subtotal),d.append(u),d.append(l.html()),a=d.prop("outerHTML")}return a},this.initialize=function(){a.filters.add_filter("bundle_totals",this.filter_bundle_totals,10,this),a.filters.add_filter("bundle_total_price_html",this.filter_bundle_total_price_html,10,this)}};t(".bundle_form .bundle_data").on("woocommerce-product-bundle-initializing",function(t,i){new a(i).initialize()}),t(".composite_component").on("wc-composite-component-loaded",function(t,i){"bundle"===i.get_selected_product_type()&&(bundle=i.get_bundle_script(),new a(bundle).initialize())})}(jQuery);