!function(r){function a(t){this.round_price=function(t){return wc_pb_number_round(t,wc_bundle_params.discounted_price_decimals)},this.filter_bundle_totals=function(t,i,a,n){if(void 0===i.bulk_discount_data||!1===i.bulk_discount_data)return t;var e=this,_=i.quantities,u=i.bulk_discount_data.discount_array,s=0,c=0;if(0<u.length){for(var d in _)c+=_[d];for(var l,o=0;o<u.length;o++)void 0!==u[o].quantity_min&&void 0!==u[o].quantity_max&&void 0!==u[o].discount&&c>=u[o].quantity_min&&(c<=u[o].quantity_max||""===u[o].quantity_max)&&(s=u[o].discount);0<(a.price_data.bulk_discount_data.discount=s)&&(l=r.extend(!0,{},i),r.each(a.bundled_items,function(t,i){l.prices[i.bundled_item_id]=e.round_price(l.prices[i.bundled_item_id]*(1-s/100))}),"yes"===a.price_data.bulk_discount_data.discount_base&&l.base_price&&(l.base_price=e.round_price(Number(l.base_price)*(1-s/100))),l.bulk_discount_data=!1,l=a.calculate_subtotals(!1,l,n),t=(l=a.calculate_totals(l)).totals)}return t},this.filter_bundle_total_price_html=function(t,i){return void 0===i.price_data.bulk_discount_data||i.price_data.bulk_discount_data.discount&&i.price_data.subtotals.price!==i.price_data.totals.price&&(n="",(a=r.extend(!0,{},i.price_data)).totals.regular_price=a.subtotals.price,t=i.get_price_html(a),a.totals=a.subtotals,a.show_total_string="yes",n=i.get_price_html(a),a='<span class="discount">'+wc_bundle_params.i18n_bulk_discount+"</span>",i='<span class="discount-amount">'+wc_bundle_params.i18n_bulk_discount_value.replace("%v",wc_pb_number_round(i.price_data.bulk_discount_data.discount,2))+"</span>",a='<span class="price-discount">'+wc_bundle_params.i18n_bulk_discount_format.replace("%s",a).replace("%v",i)+"</span>",i=r(t).wrapInner('<span class="price-total"></span>'),(n=r(n).wrapInner('<span class="price-subtotal"></span>')).find("span.total").text(wc_bundle_params.i18n_bulk_discount_subtotal),n.append(a),n.append(i.html()),t=n.prop("outerHTML")),t;var a,n},this.initialize=function(){t.filters.add_filter("bundle_totals",this.filter_bundle_totals,10,this),t.filters.add_filter("bundle_total_price_html",this.filter_bundle_total_price_html,10,this)}}r(".bundle_form .bundle_data").on("woocommerce-product-bundle-initializing",function(t,i){new a(i).initialize()}),r(".composite_component").on("wc-composite-component-loaded",function(t,i){"bundle"===i.get_selected_product_type()&&(i=i.get_bundle_script(),new a(i).initialize())})}(jQuery);