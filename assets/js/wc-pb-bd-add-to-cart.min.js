!function(r){function i(a){this.round_price=function(t){return wc_pb_number_round(t,wc_bundle_params.discounted_price_decimals)},this.filter_bundle_totals=function(t,a,i,e){if(void 0===a.bulk_discount_data||!1===a.bulk_discount_data)return t;var n=this,_=a.quantities,u=a.bulk_discount_data.discount_array,s=0,c=0;if(0<u.length){for(var d in _)c+=_[d];for(var o,l=0;l<u.length;l++)void 0!==u[l].quantity_min&&void 0!==u[l].quantity_max&&void 0!==u[l].discount&&c>=u[l].quantity_min&&(c<=u[l].quantity_max||""===u[l].quantity_max)&&(s=u[l].discount);0<(i.price_data.bulk_discount_data.discount=s)&&(o=r.extend(!0,{},a),r.each(i.bundled_items,function(t,a){o.prices[a.bundled_item_id]=n.round_price(o.prices[a.bundled_item_id]*(1-s/100))}),"yes"===i.price_data.bulk_discount_data.discount_base&&o.base_price&&(o.base_price=n.round_price(Number(o.base_price)*(1-s/100))),o.bulk_discount_data=!1,o=i.calculate_subtotals(!1,o,e),t=(o=i.calculate_totals(o)).totals)}return t},this.filter_bundle_total_price_html=function(t,a){return void 0===a.price_data.bulk_discount_data||a.price_data.bulk_discount_data.discount&&a.price_data.subtotals.price!==a.price_data.totals.price&&(e="",(i=r.extend(!0,{},a.price_data)).totals.regular_price=i.subtotals.price,t=a.get_price_html(i),i.totals=i.subtotals,i.show_total_string="yes",e=a.get_price_html(i),i='<span class="discount">'+wc_bundle_params.i18n_bulk_discount+"</span>",a='<span class="discount-amount">'+wc_bundle_params.i18n_bulk_discount_value.replace("%v",wc_pb_number_round(a.price_data.bulk_discount_data.discount,2))+"</span>",i='<span class="price-discount">'+wc_bundle_params.i18n_bulk_discount_format.replace("%s",i).replace("%v",a)+"</span>",a=r(t).wrapInner('<span class="price-total"></span>'),(e=r(e).wrapInner('<span class="price-subtotal"></span>')).find("span.total").text(wc_bundle_params.i18n_bulk_discount_subtotal),e.append(i),e.append(a.html()),t=e.prop("outerHTML")),t;var i,e},this.initialize=function(){a.filters.add_filter("bundle_totals",this.filter_bundle_totals,10,this),a.filters.add_filter("bundle_total_price_html",this.filter_bundle_total_price_html,10,this),"yes"===a.price_data.bulk_discount_data.discount_base&&a.price_data.base_price&&a.$bundle_data.on("woocommerce-product-bundle-update",function(t){a.dirty_subtotals=!0})}}r(".bundle_form .bundle_data").on("woocommerce-product-bundle-initializing",function(t,a){new i(a).initialize()}),r(".composite_component").on("wc-composite-component-loaded",function(t,a){"bundle"===a.get_selected_product_type()&&(a=a.get_bundle_script(),new i(a).initialize())})}(jQuery);