!function(l){function e(i){this.round_price=function(t){return wc_pb_number_round(t,wc_bundle_params.discounted_price_decimals)},this.filter_bundle_totals=function(t,i,e,a){if(void 0===i.bulk_discount_data||!1===i.bulk_discount_data)return t;var n=this,_=i.quantities,d=i.bulk_discount_data.discount_array,u=0,c=0;if(0<d.length){for(var s in _)c+=_[s];for(var o,r=0;r<d.length;r++)void 0!==d[r].quantity_min&&void 0!==d[r].quantity_max&&void 0!==d[r].discount&&c>=d[r].quantity_min&&(c<=d[r].quantity_max||""===d[r].quantity_max)&&(u=d[r].discount);0<(e.price_data.bulk_discount_data.discount=u)&&(o=l.extend(!0,{},i),l.each(e.bundled_items,function(t,i){"yes"===o.bulk_discounts_on_regular_price[i.bundled_item_id]?o.prices[i.bundled_item_id]=n.round_price(o.regular_prices[i.bundled_item_id]*(1-u/100)):o.prices[i.bundled_item_id]=n.round_price(o.prices[i.bundled_item_id]*(1-u/100))}),"yes"===e.price_data.bulk_discount_data.discount_base&&o.base_price&&(o.base_price=n.round_price(Number(o.base_price)*(1-u/100))),o.bulk_discount_data=!1,o=e.calculate_subtotals(!1,o,a),t=(o=e.calculate_totals(o)).totals)}return t},this.filter_bundle_total_price_html=function(t,i){return void 0===i.price_data.bulk_discount_data||i.price_data.bulk_discount_data.discount&&i.price_data.subtotals.price!==i.price_data.totals.price&&(a="",(e=l.extend(!0,{},i.price_data)).totals.regular_price=e.subtotals.price,t=i.get_price_html(e),e.totals=e.subtotals,e.show_total_string="yes",a=i.get_price_html(e),e='<span class="discount">'+wc_bundle_params.i18n_bulk_discount+"</span>",i='<span class="discount-amount">'+wc_bundle_params.i18n_bulk_discount_value.replace("%v",wc_pb_number_round(i.price_data.bulk_discount_data.discount,2))+"</span>",e='<span class="price-discount">'+wc_bundle_params.i18n_bulk_discount_format.replace("%s",e).replace("%v",i)+"</span>",i=l(t).wrapInner('<span class="price-total"></span>'),(a=l(a).wrapInner('<span class="price-subtotal"></span>')).find("span.total").text(wc_bundle_params.i18n_bulk_discount_subtotal),a.append(e),a.append(i.html()),t=a.prop("outerHTML")),t;var e,a},this.initialize=function(){void 0!==i.price_data.bulk_discount_data&&(i.filters.add_filter("bundle_totals",this.filter_bundle_totals,10,this),i.filters.add_filter("bundle_total_price_html",this.filter_bundle_total_price_html,10,this),"yes"===i.price_data.bulk_discount_data.discount_base&&i.price_data.base_price&&i.$bundle_data.on("woocommerce-product-bundle-update",function(t){i.dirty_subtotals=!0}))}}l(".bundle_form .bundle_data").on("woocommerce-product-bundle-initializing",function(t,i){new e(i).initialize()}),l(".composite_component").on("wc-composite-component-loaded",function(t,i){"bundle"===i.get_selected_product_type()&&(i=i.get_bundle_script(),new e(i).initialize())})}(jQuery);